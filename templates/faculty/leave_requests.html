<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Leave Requests - Faculty View</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body class="bg-light">
  <div class="container py-4">
    <h2 class="mb-4">Student Leave Requests</h2>
    <div class="table-responsive">
      <table class="table table-bordered table-striped">
        <thead class="table-dark">
          <tr>
            <th>USN</th>
            <th>Subject</th>
            <th>Start Date</th>
            <th>End Date</th>
            <th>Reason</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="leaveRequestsTableBody">
          <!-- Rows will be dynamically inserted here -->
        </tbody>
      </table>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const tableBody = document.getElementById("leaveRequestsTableBody");
      const data = JSON.parse(localStorage.getItem("leaveRequests")) || [];

      if (data.length === 0) {
        tableBody.innerHTML = '<tr><td colspan="7" class="text-center text-muted">No leave requests found.</td></tr>';
      } else {
        data.forEach((req, index) => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${req.usn || "N/A"}</td>
            <td>${req.subject}</td>
            <td>${req.startDate}</td>
            <td>${req.endDate}</td>
            <td>${req.reason}</td>
            <td><span class="badge ${getStatusClass(req.status)}">${req.status}</span></td>
            <td>
              <button class="btn btn-sm btn-success me-1" onclick="updateStatus(${index}, 'Approved')">Approve</button>
              <button class="btn btn-sm btn-danger" onclick="updateStatus(${index}, 'Rejected')">Reject</button>
            </td>
          `;
          tableBody.appendChild(row);
        });
      }
    });

    function getStatusClass(status) {
      if (status === "Approved") return "bg-success";
      if (status === "Rejected") return "bg-danger";
      return "bg-warning text-dark";
    }

    function updateStatus(index, newStatus) {
      const data = JSON.parse(localStorage.getItem("leaveRequests")) || [];
      if (data[index]) {
        data[index].status = newStatus;
        localStorage.setItem("leaveRequests", JSON.stringify(data));
        location.reload();
      }
    }
  </script>
</body>
</html>
